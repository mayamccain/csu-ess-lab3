---
title: "Lab 3: COVID Wrangling"
subtitle: "ESS 330"
author: "Maya McCain" 
name: \\https://mayamccain.github.io/
email: "maya.mccain@colostate.edu"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(dplyr)
library(flextable)
library(zoo)
library(skimr)
```

#Question 1

```{r}
url = 'https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv'
covid = read_csv(url)
```

#Question 2

```{r}
library(tidyverse); library(flextable)
data = read_csv('https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv')

my.date <- as.Date("2022-02-01")
class(my.date)

my.state <- "Colorado"
class(my.state)
```

#Question 3

```{r}
daily_summary <- covid %>%
  filter(state == "Colorado") %>%
  group_by(county) %>%
  arrange(county, date) %>%
  mutate(daily_new_cases = cases - lag(cases)) %>%
  ungroup()
head(daily_summary)
as_flextable(head(daily_summary)) %>% 
flextable::set_caption("Daily Summary of Cumulative Cases")
```

```{r}
cumulative_cases <- daily_summary %>% 
  filter(date == my.date) %>%
  group_by(county) %>%
  summarise(cumulative_cases = sum(cases)) %>%
  arrange(-cumulative_cases) %>%
  slice(1:5)
as_flextable(head(cumulative_cases)) %>% 
flextable::set_caption("Counties with Most Cumulative COVID Cases")
```

```{r}
new_cases <- daily_summary %>% 
  filter(date == my.date) %>%
  group_by(county) %>%
  summarise(new_cases = sum(daily_new_cases)) %>%
  arrange(-new_cases) %>%
  slice(1:5)
as_flextable(head(new_cases)) %>% 
flextable::set_caption("Counties with Most New COVID Cases")
```

#Question 3

```{r}
pop_url <- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'
pop <- read_csv(pop_url) %>%
  filter(COUNTY != "000") %>% 
  mutate(fips = sprintf("%05s", paste0(STATE, COUNTY))) %>%  
  select(fips, contains("NAME"), contains("2021"))
```

```{r}
names(pop)
dim(pop)
nrow(pop)
str(pop)
glimpse(pop)
```

## There are numeric and character atrributes in this modified dataset. The column names are the fips column and all the columns that contain "2021" or "NAME." All the column names are different from the original covid dataset except for the fips code. This dataset now has 3144 rows and 19 columns. 

##What is the range of populations seen in Colorado counties in 2021:
```{r}
max(pop$POPESTIMATE2021, na.rm = TRUE)

min(pop$POPESTIMATE2021, na.rm = TRUE)

```
## Population of Colorado counties ranged from 54 to 9,809,462 in 2021. 


##Join the population data to the Colorado COVID data and compute the per capita cumulative cases, per capita new cases, and per capita new deaths:
```{r}
pop_url <- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'
pop_joined <- read_csv(pop_url) %>%
  filter(COUNTY != "000") %>% 
  mutate(fips = sprintf("%05s", paste0(STATE, COUNTY))) %>%
  right_join(covid) %>% 
  select(fips, contains("NAME"), contains("2021"))
print(pop_joined)

```
```{r}
per_cap <- pop_joined %>% 
  summarize(cumulative_cases = sum(new_cases, na.rm = TRUE),
            population = sum(POPESTIMATE2021, na.rm = TRUE)) 

per_cap <- per_cap %>%
  mutate(per_cap_cumulative = cumulative_cases / population)

print(per_cap)

str(pop_joined)

```
#Generate (2) new tables. The first should show the 5 counties with the most cumulative cases per capita on 2021-01-01, and the second should show the 5 counties with the most NEW cases per capita on the same date. Your tables should have clear column names and descriptive captions.

```{r}
per_cap_cumulative <- daily_summary %>% 
  filter(date == my.date) %>%
  group_by(county) %>%
  summarise(per_cap_cumulative = sum(cases)) %>%
  arrange(-per_cap_cumulative) %>%
  slice(1:5)
as_flextable(head(per_cap_cumulative)) %>% 
flextable::set_caption("Counties with Most Cumulative COVID Cases Per Capita on 2021-01-01")
```

